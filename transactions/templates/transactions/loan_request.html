{% extends 'base.html' %}

{% block head_title %}
  <title>{{ title }}</title>
{% endblock head_title %}

{% block body %}
<div class="min-h-screen bg-[url('/static/background/background.jpg')] py-12 px-4">
  <div class="max-w-7xl mx-auto">

    <!-- Profile Header -->
    <div class="relative bg-white shadow-xl rounded-2xl p-6 mb-10 z-10 flex flex-col md:flex-row items-center justify-between gap-6">
      <div class="flex items-center gap-4">
        <img src="https://i.pravatar.cc/100" alt="Avatar" class="w-16 h-16 rounded-full border-2 border-indigo-600" />
        <div>
          <h2 class="text-2xl font-bold text-gray-800">Hi, {{ user.username|capfirst }} ðŸ‘‹</h2>
          <p class="text-gray-500 text-sm">{{ user.email }}</p>
        </div>
      </div>
      <div class="flex gap-3">
        <a href="{% url 'dashboard' %}" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg text-sm font-medium shadow">
          Dashboard
        </a>
        <a href="{% url 'logout' %}" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-lg text-sm font-medium border">
          Logout
        </a>
      </div>
    </div>

    <!-- Loan Summary Cards -->
    <div class="relative grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8 z-10">
      <div class="bg-indigo-100 p-5 rounded-xl shadow text-indigo-800">
        <h3 class="text-sm font-medium">Total Loans</h3>
        <p class="text-2xl font-bold mt-1">{{ loans|length }}</p>
      </div>
      <div class="bg-green-100 p-5 rounded-xl shadow text-green-800">
        <h3 class="text-sm font-medium">Approved</h3>
        <p class="text-2xl font-bold mt-1">{{ loans|filter:"loan_approve"|length }}</p>
      </div>
      <div class="bg-red-100 p-5 rounded-xl shadow text-red-800">
        <h3 class="text-sm font-medium">Pending</h3>
        <p class="text-2xl font-bold mt-1">{{ loans|exclude:"loan_approve"|length }}</p>
      </div>
    </div>

    <!-- Table Header & Search -->
    <div class="relative flex flex-col md:flex-row justify-between items-center mb-4 gap-4 z-10">
      <h2 class="text-2xl font-semibold text-indigo-700">Loan Report</h2>
      <div class="flex items-center gap-3">
        <input type="text" placeholder="Search by ID..." class="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none text-sm" />
        <button class="bg-gray-100 hover:bg-gray-200 text-sm px-4 py-2 rounded-lg border">Export CSV</button>
        <button class="bg-gray-100 hover:bg-gray-200 text-sm px-4 py-2 rounded-lg border">Export PDF</button>
      </div>
    </div>

    <!-- Loan Table -->
    <div class="relative bg-white shadow-lg rounded-2xl overflow-x-auto z-10">
      <table class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
          <tr>
            <th class="px-6 py-3 text-left font-semibold">Loan ID</th>
            <th class="px-6 py-3 text-left font-semibold">Amount</th>
            <th class="px-6 py-3 text-left font-semibold">Status</th>
            <th class="px-6 py-3 text-left font-semibold">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for loan in loans %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-3 font-medium text-gray-700">{{ loan.id }}</td>
            <td class="px-6 py-3">
              <span class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-full">
                Rs. {{ loan.amount }}
              </span>
            </td>
            <td class="px-6 py-3">
              {% if loan.loan_approve %}
                <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-3 py-1 rounded-full">Approved</span>
              {% else %}
                <span class="bg-red-100 text-red-700 text-xs font-semibold px-3 py-1 rounded-full">Pending</span>
              {% endif %}
            </td>
            <td class="px-6 py-3">
              {% if loan.loan_approve %}
              <a href="{% url 'pay' loan.id %}" class="bg-red-600 hover:bg-red-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition">Pay</a>
              {% else %}
              <span class="text-gray-500 italic text-sm">Awaiting Approval</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock body %}
