{% extends 'base.html' %}
{% load static %}

{% block head_title %}
<title>Profile</title>
{% endblock head_title %}

{% block body %}
<div class="max-w-5xl mx-auto px-4 py-12">
  <div class="bg-white shadow-xl rounded-3xl p-6 sm:p-10 space-y-10">

    <!-- Success Message -->
    {% if messages %}
      {% for message in messages %}
        <div class="bg-green-100 border border-green-400 text-green-800 px-6 py-4 rounded-lg animate-fade-in shadow">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Non-field Errors -->
    {% if form.non_field_errors %}
      {% for error in form.non_field_errors %}
        <div class="bg-red-100 border border-red-400 text-red-800 px-6 py-4 rounded-lg animate-fade-in shadow">
          {{ error }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 border-b pb-4">
      <h2 class="text-xl font-semibold text-gray-800">Account No: <span class="text-green-600 font-mono">*********</span></h2>
      <a href="{% url 'change_pass' %}" class="text-green-600 hover:text-green-700 font-medium">Change Password</a>
    </div>

    <!-- Avatar Upload -->
    
    <!-- Page Title -->
    <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-900">Update Profile</h1>

    <!-- Profile Form -->
    <form method="post" enctype="multipart/form-data" class="space-y-8">
      {% csrf_token %}
      {% for hidden_field in form.hidden_fields %}
        {{ hidden_field }}
      {% endfor %}
<div class="flex justify-center">
      <label for="id_avatar" class="relative group cursor-pointer">
        <img
          id="avatarPreview"
          src="/media/{{ avatar }}"
          alt="Profile Avatar"
          class="w-32 h-32 rounded-full object-cover border-4 border-green-500 shadow-lg transition group-hover:scale-105"
        />
        <input type="file" name="avatar" id="id_avatar" accept="image/*" class="hidden" onchange="previewAvatar(event)">
        <div class="absolute bottom-0 right-0 bg-green-600 p-2 rounded-full shadow text-white group-hover:bg-green-700 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15.232 5.232l3.536 3.536M16.5 3a2.121 2.121 0 113 3L7 18.5 3 19l.5-4L16.5 3z" />
          </svg>
        </div>
      </label>
    </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
        {% for field in form.visible_fields %}

          <div>
            <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-semibold text-gray-700">
              {{ field.label }}
            </label>
            {{ field }}
            {% if field.help_text %}
              <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
            {% endif %}
            {% if field.errors %}
              {% for error in field.errors %}
                <p class="text-xs text-red-600 mt-1">{{ error }}</p>
              {% endfor %}
            {% endif %}
          </div>
        {% endfor %}

      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-4 pt-4">
        <button type="reset"
          class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded-lg shadow-sm transition">
          Reset
        </button>
        <button type="submit"
          class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-8 rounded-lg shadow-lg transition">
          Update
        </button>
      </div>
    </form>
  </div>
</div>

<!-- JS Preview -->
<script>
  function previewAvatar(event) {
    const input = event.target;
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById('avatarPreview').src = e.target.result;
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

<!-- Animation -->
<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-5px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.4s ease forwards;
  }

  input[type="text"],
  input[type="email"],
  input[type="file"],
  input[type="password"],
  select,
  textarea {
    @apply w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 text-gray-900 shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition;
  }
</style>
{% endblock %}
