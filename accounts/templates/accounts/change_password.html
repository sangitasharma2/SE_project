{% extends 'base.html' %}

{% block body %}
<section class="min-h-screen bg-cover bg-center bg-no-repeat bg-[url('/static/background/background.jpg')] py-1 px-1">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-10 sm:p-12 relative z-10">
    
    <h2 class="text-4xl font-extrabold text-center text-indigo-900 mb-10 tracking-wide drop-shadow-md">
      Reset Password
    </h2>

    {% if form.non_field_errors %}
      <div class="mb-8 p-4 bg-red-50 border border-red-400 text-red-700 rounded-lg flex items-center space-x-3" role="alert" aria-live="assertive">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <ul class="list-disc list-inside text-sm font-medium">
          {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" class="space-y-6" novalidate>
      {% csrf_token %}
      
      {% for hidden_field in form.hidden_fields %}
        {{ hidden_field.errors }}
        {{ hidden_field }}
      {% endfor %}

      {% for field in form.visible_fields %}
        <div>
          <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-semibold text-gray-700">
            {{ field.label }}
          </label>
          <div class="relative">
            <input
              name="{{ field.name }}"
              id="{{ field.id_for_label }}"
              type="{{ field.widget_type }}"
              placeholder="{{ field.label }}"
              required
              aria-describedby="{{ field.id_for_label }}-error"
              class="w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 text-gray-900 placeholder-gray-400 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-400 focus:outline-none transition"
            />
            {% if field.name == 'new_password' or field.name == 'confirm_password' %}
              <button
                type="button"
                aria-label="Toggle password visibility"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-indigo-600 focus:outline-none"
                onclick="togglePasswordVisibility('{{ field.id_for_label }}', this)"
                tabindex="-1"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" id="{{ field.id_for_label }}-eye-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
              </button>
            {% endif %}
          </div>
          {% if field.name == 'new_password' %}
            <div class="mt-2">
              <div class="w-full h-2 bg-gray-300 rounded-full overflow-hidden">
                <div id="password-strength-bar" class="h-2 bg-red-500 transition-all duration-300" style="width: 0%"></div>
              </div>
              <p id="password-strength-text" class="mt-1 text-xs font-semibold text-gray-600">Password Strength: <span class="font-bold">Too Weak</span></p>
            </div>
          {% endif %}
          {% if field.errors %}
            <p id="{{ field.id_for_label }}-error" class="mt-1 text-xs text-red-600" role="alert">
              {% for error in field.errors %}
                {{ error }}
              {% endfor %}
            </p>
          {% endif %}
        </div>
      {% endfor %}

      <button
        type="submit"
        class="w-full bg-indigo-600 hover:bg-indigo-700 focus:bg-indigo-700 text-white font-semibold py-3 rounded-lg shadow-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-1"
      >
        Save
      </button>
    </form>
  </div>

  <script>
    function togglePasswordVisibility(inputId, btn) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById(inputId + '-eye-icon');
      if (input.type === 'password') {
        input.type = 'text';
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.974 9.974 0 012.363-3.506m1.147-1.147A9.966 9.966 0 0112 5c4.477 0 8.268 2.943 9.542 7-0.42 1.344-1.155 2.58-2.163 3.59m-2.242 2.242L3 3" />';
      } else {
        input.type = 'password';
        icon.innerHTML = `
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        `;
      }
    }

    const passwordInput = document.querySelector('input[name="new_password"]');
    const strengthBar = document.getElementById('password-strength-bar');
    const strengthText = document.getElementById('password-strength-text');

    if (passwordInput) {
      passwordInput.addEventListener('input', () => {
        const val = passwordInput.value;
        let strength = 0;

        if (val.length >= 8) strength++;
        if (/[A-Z]/.test(val)) strength++;
        if (/[0-9]/.test(val)) strength++;
        if (/[^A-Za-z0-9]/.test(val)) strength++;

        const widths = ['0%', '25%', '50%', '75%', '100%'];
        const colors = ['bg-red-500', 'bg-yellow-400', 'bg-yellow-500', 'bg-green-400', 'bg-green-600'];
        const texts = ['Too Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];

        strengthBar.style.width = widths[strength];
        colors.forEach(c => strengthBar.classList.remove(c));
        strengthBar.classList.add(colors[strength]);
        strengthText.querySelector('span').textContent = texts[strength];
      });
    }
  </script>
</section>
{% endblock %}

